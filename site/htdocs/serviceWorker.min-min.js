"use strict";!function(){var e="v::171::".split("::")[1],n=function(e,n,t){caches.open(e).then(function(e){e.put(n,t)})},t=function(e,n){caches.open(e).then(function(c){c.keys().then(function(i){i.length>n&&c.delete(i[0]).then(t(e,n))})})};self.addEventListener("install",function(n){n.waitUntil(caches.open("v::171::static").then(function(n){return n.addAll(["/chronicle/"]),n.addAll(["/","/images/autumn-earth.svg","/css/base."+e+".css","/js/core.min."+e+".js","/offline/","/images/offline-fallback.jpg"])}).then(function(){return self.skipWaiting()}))}),self.addEventListener("activate",function(e){e.waitUntil(caches.keys().then(function(e){return Promise.all(e.filter(function(e){return 0!==e.indexOf("v::171::")}).map(function(e){return caches.delete(e)}))}).then(function(){return self.clients.claim()}))}),self.addEventListener("message",function(e){"trimCaches"==e.data.command&&(t("v::171::pages",20),t("v::171::images",30),t("v::171::assets",10))}),self.addEventListener("fetch",function(e){var t=e.request;new URL(t.url);"GET"===t.method&&(-1===t.headers.get("Accept").indexOf("text/html")?e.respondWith(caches.match(t).then(function(e){return e||fetch(t).then(function(e){if(t.url.match(/\.(jpe?g|png|gif|svg)$/)){var c=e.clone();n("v::171::images",t,c)}if(-1!==t.url.indexOf("/fonts/")||-1!==t.url.indexOf("/js/")||-1!==t.url.indexOf("/css/")){c=e.clone();n("v::171::assets",t,c)}return e}).catch(function(){if(t.url.match(/\.(jpe?g|png|gif|svg)$/))return caches.match("/images/offline-fallback.jpg")})})):e.respondWith(fetch(t).then(function(e){var c=e.clone();return n("v::171::pages",t,c),e}).catch(function(){return caches.match(t).then(function(e){return e||caches.match("/offline/")})})))})}();