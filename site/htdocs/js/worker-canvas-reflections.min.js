var ca,c,source,w,h,dw,dh,waves=10,speed=.05,scale=.5,offset=0,frame=0,max_frames=0;function lake(){w=c.canvas.width,h=c.canvas.height,dw=w,dh=h;for(var a=source.data.slice(),e=new ImageData(a,w,h).data,s=source,t=source.data,d=0,o=0;o<dh;o++)for(var f=0;f<dw;f++){var r=10*scale*Math.sin(dh/(o/waves)-offset)|0,n=4*(((r=10*scale*Math.sin(o/waves*.15-offset)|0)+o)*w+f+r);n<0?d+=4:(t[d]=e[n],t[++d]=e[++n],t[++d]=e[++n],t[++d]=e[++n],++d)}offset+=speed,frame++,c.putImageData(s,0,0),postMessage("done")}self.onmessage=function(a){a.data.source&&(source=a.data.source),a.data.canvas&&(ca=a.data.canvas,c=ca.getContext("2d")),lake()};