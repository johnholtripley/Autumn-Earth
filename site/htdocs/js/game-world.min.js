function init(){gameCanvas=document.getElementById("gameWorld"),gameCanvas.getContext&&(gameContext=gameCanvas.getContext("2d")),gameMode="loading",gameLoop(),hero.img=new Image,hero.img.src="/images/game-world/core/TEMP-link.png",backgroundImg=new Image,backgroundImg.src="/images/game-world/maps/1/bg.png",Input.init(),gameMode="play"}function checkCollisions(){var e=world.collisions,o=hero.width-2;if(key[2]){var n=Math.floor(hero.x/8),a=Math.floor((hero.x+o)/8),i=Math.floor((hero.y+9)/8),r=i*NUM_TILES_WIDE+n,t=i*NUM_TILES_WIDE+a;(1==e[r]||1==e[t])&&(hero.y=8*i)}if(key[3]){var h=Math.floor(hero.x/8),m=Math.floor((hero.x+hero.width-1)/8),i=Math.floor((hero.y+hero.height)/8),d=i*NUM_TILES_WIDE+h,s=i*NUM_TILES_WIDE+m;(1==e[d]||1==e[s])&&(hero.y=8*i-hero.height)}if(key[0]){var g=Math.floor(hero.x/8),c=Math.floor((hero.y+9)/8),w=Math.floor((hero.y+hero.height-1)/8),r=c*NUM_TILES_WIDE+g,d=w*NUM_TILES_WIDE+g;(1==e[r]||1==e[d])&&(hero.x=8*g+8)}if(key[1]){var g=Math.floor((hero.x+hero.width)/8),l=Math.floor((hero.y+9)/8),f=Math.floor((hero.y+hero.height-1)/8),t=l*NUM_TILES_WIDE+g,s=f*NUM_TILES_WIDE+g;(1==e[t]||1==e[s])&&(hero.x=8*g-hero.width)}}function gameLoop(){switch(gameMode){case"loading":break;case"paused":break;case"play":update(),draw()}window.requestAnimationFrame(gameLoop)}function update(){var e=window.performance.now(),o=e-lastTime;if(lastTime=e,hero.isMoving=!1,key[2]&&(hero.isMoving=!0,hero.facing="up",hero.y-=hero.speed),key[3]&&(hero.isMoving=!0,hero.facing="down",hero.y+=hero.speed),key[0]&&(hero.isMoving=!0,hero.facing="left",hero.x-=hero.speed),key[1]&&(hero.isMoving=!0,hero.facing="right",hero.x+=hero.speed),checkCollisions(),hero.timeSinceLastFrameSwap+=o,hero.timeSinceLastFrameSwap>hero.animationUpdateTime){var n=(hero.isMoving?"walk-":"stand-")+hero.facing,a=hero.sequences[n];hero.animationFrameIndex<a.length-1?hero.animationFrameIndex+=1:hero.animationFrameIndex=0;var i=a[hero.animationFrameIndex]%7,r=Math.floor(a[hero.animationFrameIndex]/7);hero.offsetX=i*hero.width,hero.offsetY=r*hero.height,hero.timeSinceLastFrameSwap=0}}function draw(){gameContext.drawImage(backgroundImg,0,0),gameContext.drawImage(hero.img,hero.offsetX,hero.offsetY,hero.width,hero.height,hero.x,hero.y,hero.width,hero.height)}var animationFramesPerSecond=16,lastTime=0,elapsed=0,width=256,ROOM_HEIGHT=176,TILE_WIDTH=8,NUM_TILES_WIDE=width/TILE_WIDTH,NUM_TILES_HIGH=ROOM_HEIGHT/TILE_WIDTH,key=[0,0,0,0,0],hero={x:100,y:100,width:17,height:25,speed:2,animationFrameIndex:0,timeSinceLastFrameSwap:0,animationUpdateTime:1e3/animationFramesPerSecond,isMoving:!1,facing:"down",sequences:{"stand-down":[3],"stand-up":[10],"stand-right":[17],"stand-left":[24],"walk-down":[3,4,5,6,5,4,3,2,1,0,1,2],"walk-up":[10,11,12,13,12,11,10,9,8,7,8,9],"walk-right":[17,18,19,20,19,18,17,16,15,14,15,16],"walk-left":[24,25,26,27,26,25,24,23,22,21,22,23]}};!function(){for(var e=0,o=["ms","moz","webkit","o"],n=0;n<o.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[o[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[o[n]+"CancelAnimationFrame"]||window[o[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(o,n){var a=(new Date).getTime(),i=Math.max(0,16-(a-e)),r=window.setTimeout(function(){o(a+i)},i);return e=a+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var Input={init:function(){document.addEventListener("keydown",function(e){Input.changeKey(e.keyCode,1)}),document.addEventListener("keyup",function(e){Input.changeKey(e.keyCode,0)})},changeKey:function(e,o){switch(e){case KeyBindings.left:key[0]=o;break;case KeyBindings.up:key[2]=o;break;case KeyBindings.right:key[1]=o;break;case KeyBindings.down:key[3]=o;break;case KeyBindings.action:key[4]=o}}},KeyBindings={left:37,right:39,up:38,down:40,action:32},world={collisions:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]};"serviceWorker"in navigator&&navigator.serviceWorker.register("/game-world/serviceWorker.min.js",{scope:"/game-world/"}),"querySelectorAll"in document&&"addEventListener"in window&&window.HTMLCanvasElement&&init();