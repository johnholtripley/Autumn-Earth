<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offscreen Canvas</title>
</head>
<body>
  <div>
    <h1>Canvas on worker thread</h1>
    <canvas id="canvas-worker" width="400" height="400"></canvas>
  </div>
<script>
if('OffscreenCanvas' in window) {
  const worker = new Worker('worker.js');
  const offscreen = document.querySelector('#canvas-worker').transferControlToOffscreen();
  let workerStarted = false;

  function playAnimation() {
      if (workerStarted) {
        worker.postMessage({ msg: 'start' });
      } else {
        const urlParts = location.href.split('/');
        if (urlParts[urlParts.length - 1].indexOf('.') !== -1) {
          urlParts.pop();
        }
        worker.postMessage({ msg: 'start', origin: urlParts.join('/'), canvas: offscreen }, [offscreen]);
        workerStarted = true;
      }
  }
  playAnimation();
}
</script>
</body>
</html>