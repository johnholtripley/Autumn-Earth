"use strict";!function(){var e="v::170::",n=e.split("::")[1],t=e+"static",c=e+"pages",i=e+"images",r=e+"assets",a="/images/offline-fallback.jpg",s=function(){return caches.open(t).then(function(e){return e.addAll(["/chronicle/"]),e.addAll(["/","/images/autumn-earth.svg","/css/base."+n+".css","/js/core.min."+n+".js","/offline/",a])})},f=function(e,n,t){caches.open(e).then(function(e){e.put(n,t)})},o=function(e,n){caches.open(e).then(function(t){t.keys().then(function(c){c.length>n&&t["delete"](c[0]).then(o(e,n))})})},u=function(){return caches.keys().then(function(n){return Promise.all(n.filter(function(n){return 0!==n.indexOf(e)}).map(function(e){return caches["delete"](e)}))})};self.addEventListener("install",function(e){e.waitUntil(s().then(function(){return self.skipWaiting()}))}),self.addEventListener("activate",function(e){e.waitUntil(u().then(function(){return self.clients.claim()}))}),self.addEventListener("message",function(e){"trimCaches"==e.data.command&&(o(c,20),o(i,30),o(r,10))}),self.addEventListener("fetch",function(e){var n=e.request,t=new URL(n.url);return t.origin===location.origin&&"GET"===n.method?-1!==n.headers.get("Accept").indexOf("text/html")?void e.respondWith(fetch(n).then(function(e){var t=e.clone();return f(c,n,t),e})["catch"](function(){return caches.match(n).then(function(e){return e||caches.match("/offline/")})})):void e.respondWith(caches.match(n).then(function(e){return e||fetch(n).then(function(e){if(-1!==n.headers.get("Accept").indexOf("image")){var t=e.clone();f(i,n,t)}if(-1!==n.url.indexOf("/fonts/")||-1!==n.url.indexOf("/js/")||-1!==n.url.indexOf("/css/")){var t=e.clone();f(r,n,t)}return e})["catch"](function(){return-1!==n.headers.get("Accept").indexOf("image")?caches.match(a):void 0})})):void 0})}();